<% User.all.each do |user| %>
  <% unless user == current_user || current_user.friends.include?(user) %>
    <div class="box">
      <article class="media">
        <div class="media-left">
          <figure class="image is-64x64">
            <img src="https://bulma.io/images/placeholders/64x64.png">
          </figure>
        </div>
        <div class="media-content">
          <div class="content">
            <%= link_to user.name, user_path(user.id) %><br />
          </div>
          <nav class="level">
            <div class="level-left is-mobile">
              <% if FriendRequest.where(user_id: current_user.id, friend_id: user.id).exists? %>
                <span><%= button_to "Cancel friend request",
                          user_friend_request_path(user.id, current_user.id),
                          method: :delete,
                          params: { friend_request: { user_id: current_user.id,
                                                      friend_id: user.id
                                                    }
                                  },
                          class: "button is-link is-light" %></span>
              <% elsif FriendRequest.where(user_id: user.id, friend_id: current_user.id).exists? %>
                <span><%= button_to "Accept",
                          user_friend_request_path(user.id, current_user.id),
                          method: :accept,
                          params: { friend_request: { user_id: user.id,
                                              friend_id: current_user.id
                                            }
                                  },
                          class: 'button is-primary' %></span>
                <span><%= button_to "Reject", user_friend_request_path(user.id, current_user.id),
                          method: :reject,
                          params: { friend_request: { user_id: current_user.id,
                                                      friend_id: user.id
                                                    }
                                  },
                          class: 'button is-danger' %></span>
              <% else %>
                <span><%= button_to "Send friend request",
                          user_friend_request_path(current_user.id,user.id),
                          method: :post,
                          params: { friend_request: { user_id: current_user.id,
                                                            friend_id: user.id
                                                          }
                                        },
                          class: "button is-link is-light" %></span>
              <% end %> 
            </div>
          </nav>
        </div>
      </article>
    </div>
  <% end %>  
<% end%>
